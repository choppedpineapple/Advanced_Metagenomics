#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

if [[ $# -ge 1 ]]; then
  INPUT_FASTQ="$1"
else
  read -rp "Enter path to merged FASTQ file: " INPUT_FASTQ
fi

if [[ $# -ge 2 ]]; then
  OUTPUT_DIR="$2"
else
  TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
  OUTPUT_DIR="analysis_runs/run_${TIMESTAMP}"
fi

mkdir -p "${OUTPUT_DIR}"

echo "Running scFv pipeline"
echo "  Input FASTQ : ${INPUT_FASTQ}"
echo "  Output dir  : ${OUTPUT_DIR}"

python3 "${SCRIPT_DIR}/scripts/run_scfv_pipeline.py" \
  --input "${INPUT_FASTQ}" \
  --output "${OUTPUT_DIR}"

echo "Pipeline finished. Results stored in ${OUTPUT_DIR}."
